{% extends "base.html" %}
{% set is_edit = edit|default(False) %}
{% block title %}{{ 'Edit' if is_edit else 'New' }} Workout – NFG{% endblock %}

{% block content %}
<h1 class="mb-4">{{ 'Edit' if is_edit else 'New' }} Workout</h1>

<form method="post" enctype="multipart/form-data" class="row g-3">

  <div class="col-md-6">
    <label class="form-label">Name</label>
    <input class="form-control" name="name" value="{{ data.get('name','') }}" required>
  </div>

  <div class="col-md-6">
    <label class="form-label">Slug</label>
    <input class="form-control" name="slug" value="{{ data.get('slug','') }}" placeholder="auto from name if empty">
  </div>

  <div class="col-md-4">
    <label class="form-label">Level</label>
    <select class="form-select" name="level">
      {% for lv in levels %}
        <option value="{{ lv }}" {{ 'selected' if data.get('level')==lv else '' }}>{{ lv }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-4">
    <label class="form-label">Body Parts (comma or newline)</label>
    <input class="form-control" name="body_parts" value="{{ data.get('body_parts','') }}">
  </div>

  <div class="col-md-4">
    <label class="form-label">Style</label>
    <select class="form-select" name="style">
      {% for st in styles %}
        <option value="{{ st }}" {{ 'selected' if data.get('style')==st else '' }}>{{ st }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-8">
    <label class="form-label">Tags (comma separated)</label>
    <input class="form-control" name="tags" value="{{ data.get('tags','') }}">
  </div>

  <div class="col-md-2">
    <label class="form-label">Rating</label>
    <input class="form-control" type="number" step="0.1" min="0" max="5" name="rating" value="{{ data.get('rating','') }}">
  </div>

  <div class="col-md-2 d-flex align-items-end">
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="fav" name="is_favorite" {{ 'checked' if data.get('is_favorite') else '' }}>
      <label class="form-check-label" for="fav">Favorite</label>
    </div>
  </div>

  <div class="col-12">
    <label class="form-label">Info (what it’s good for)</label>
    <textarea class="form-control" rows="3" name="info">{{ data.get('info','') }}</textarea>
  </div>

  <div class="col-12">
    <label class="form-label">Tips (one per line)</label>
    <textarea class="form-control" rows="3" name="tips">{{ data.get('tips','') }}</textarea>
  </div>

  <div class="col-md-6">
    <label class="form-label">YouTube URL or ID (optional)</label>
    <input class="form-control" name="youtube_id" value="{{ data.get('youtube_id','') }}" placeholder="https://youtu.be/... or 11-char id">
  </div>

  <div class="col-12 mt-3">
    <h5>Images (ordered)</h5>
    <p class="text-muted small mb-2">Top to bottom = display order. Paste a URL or upload a file; uploaded file overrides the URL input.</p>

    {% for i in range(1,5) %}
      <div class="row g-2 align-items-center mb-2">
        <div class="col-md-7">
          <input class="form-control" name="image_url_{{ i }}"
                 value="{{ (data.get('images', '').split('\n')[i-1] if data.get('images') else (data.get('images_list', [])[i-1] if data.get('images_list') and data.get('images_list')|length >= i else '')) }}"
                 placeholder="https://… or /static/uploads/…">
        </div>
        <div class="col-md-5">
          <input class="form-control" type="file" name="image_file_{{ i }}" accept="image/*">
        </div>
      </div>
    {% endfor %}

    <div class="form-text">You can reorder later by changing the top-to-bottom list.</div>
  </div>

  <div class="col-12 mt-2">
    <h6>Muscle Diagram Image (optional)</h6>
    <div class="row g-2 align-items-center">
      <div class="col-md-7">
        <input class="form-control" name="muscle_image_url" value="{{ data.get('muscle_image','') }}" placeholder="https://… or /static/uploads/…">
      </div>
      <div class="col-md-5">
        <input class="form-control" type="file" name="muscle_image_file" accept="image/*">
      </div>
    </div>
  </div>

  <div class="col-12 mt-3">
    <button class="btn btn-primary">Save</button>
    <a class="btn btn-secondary" href="{{ url_for('admin_index') }}">Cancel</a>
  </div>

</form>
{% endblock %}
