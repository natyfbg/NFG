{# backend/templates/program_environment.html #}
{% extends "base.html" %}

{% block title %}
Choose Environment – {{ hub.title if hub else "Program" }}
{% endblock %}

{% block content %}
<div class="container" style="max-width: 760px;">

  {% set level = (level or 'beginner')|lower %}
  {% set env_list = envs if envs else ['home','gym','hybrid'] %}

  <style>
    .card-press:active{ transform: scale(.995); }
    .env-card{
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 1rem;
      box-shadow: 0 .35rem .9rem rgba(0,0,0,.05);
      background:#fff;
      text-decoration:none;
      display:block;
      color: inherit;
      padding: 1rem;
    }
    .env-card .title{ font-weight: 650; color:#111; }
    .env-card .desc{ font-size:.9rem; color: rgba(0,0,0,.6); margin-top:.25rem; }
    .pill{
      display:inline-flex; align-items:center; gap:.35rem;
      border: 1px solid rgba(0,0,0,.15);
      background: rgba(0,0,0,.03);
      border-radius: 999px;
      padding: .2rem .6rem;
      font-size:.78rem;
    }
  </style>

  <!-- Top bar -->
  <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
    <div class="me-2">
      <div class="text-muted small">Step 2 of 2</div>
      <h1 class="h4 mb-1">Choose your environment</h1>
      <p class="text-muted mb-0">
        You picked <span class="pill">Level: <strong>{{ level|capitalize }}</strong></span>.
        Now choose where you train so we load the right weekly plan.
      </p>
    </div>

    <div class="d-flex gap-2">
      <!-- Back to Level -->
      <a class="btn btn-outline-secondary btn-sm"
         href="{{ url_for('program_hub_level', hub_slug=(hub.slug if hub else '8-week-challenge')) }}">
        Back
      </a>
    </div>
  </div>

  <!-- Program card -->
  <div class="card shadow-sm mb-3">
    {% if hub and hub.cover_image %}
      <img src="{{ hub.cover_image }}" alt=""
           style="width:100%;height:180px;object-fit:cover;border-top-left-radius:.75rem;border-top-right-radius:.75rem;">
    {% endif %}
    <div class="card-body">
      <div class="d-flex align-items-start justify-content-between gap-2">
        <div>
          <div class="fw-semibold">{{ hub.title if hub else "Program" }}</div>
          <div class="text-muted small">
            Pick an environment you can stay consistent with for the full plan.
          </div>
        </div>
        <span class="badge text-bg-dark">
          {{ hub.duration_label if hub and hub.duration_label else "8 weeks" }}
        </span>
      </div>

      <!-- Rules -->
      <div class="mt-3">
        <div class="fw-semibold mb-1">Program rules</div>
        {% set rules = (hub.rules if hub and hub.rules is defined else []) %}
        {% if rules and rules|length > 0 %}
          <ul class="mb-0 text-muted small">
            {% for r in rules %}
              <li>{{ r }}</li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted small">
            Keep it simple: clean food + water + protein. Scale loads to keep form clean.
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Environment options -->
  <div class="d-flex align-items-center justify-content-between mb-2">
    <h5 class="mb-0">Choose your environment</h5>
    <span class="text-muted small">Home • Gym • Hybrid</span>
  </div>

  <div class="row g-3">
    {% for env in env_list %}
      {% set env_l = env|lower %}
      {% set label = "Home" if env_l == "home" else ("Gym" if env_l == "gym" else "Hybrid") %}
      {% set desc =
        "Minimal equipment options + bodyweight-friendly structure."
        if env_l == "home" else
        ("Machines + free weights. More exercise variety and progression options."
         if env_l == "gym" else
         "Mix home + gym. Best if your schedule changes week-to-week.")
      %}

      <div class="col-12">
        <a class="env-card card-press"
           href="{{ url_for('program_hub_weeks', hub_slug=(hub.slug if hub else '8-week-challenge'), level=level, env=env_l) }}">
          <div class="title">{{ label }}</div>
          <div class="desc">{{ desc }}</div>
          <div class="mt-3">
            <span class="btn btn-sm btn-dark">Continue</span>
            <span class="text-muted small ms-2">View weeks</span>
          </div>
        </a>
      </div>
    {% endfor %}
  </div>

  <div class="card shadow-sm mt-3">
    <div class="card-body">
      <div class="fw-semibold mb-1">Tip</div>
      <div class="text-muted small">
        If you’re unsure, pick <strong>Home</strong> for consistency. You can switch later.
      </div>
    </div>
  </div>

</div>
{% endblock %}
