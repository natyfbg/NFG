{% extends "base.html" %}
{% block title %}All Workouts (A–Z) – NFG{% endblock %}

{% block sidebar %}
  {% include "quick_options.html" %}
{% endblock %}

{% block content %}
<h1 class="mb-1">All Workouts (A–Z)</h1>
<p class="text-muted mb-3">{{ items|length }} workout{{ '' if (items|length)==1 else 's' }}</p>

{% if not items %}
  <div class="alert alert-secondary">
    No workouts yet. Try <a href="{{ url_for('workouts_browse') }}">Browse</a> or add some in Admin.
  </div>
{% else %}
  {# Denser grid like Search: 2 / 3 / 4 columns #}
  <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-2">
    {% for w in items %}
      {% set parts  = w.body_parts if w.body_parts else ([w.body_part] if w.body_part else []) %}
      {% set thumbs = (w.images if w.images else []) %}
      {% if (not thumbs or thumbs|length == 0) and w.muscle_image %}
        {% set thumbs = [w.muscle_image] %}
      {% endif %}
      {% if not thumbs or thumbs|length == 0 %}
        {% set thumbs = ['https://via.placeholder.com/800x450?text=Image+Coming+Soon'] %}
      {% endif %}
      {% set cid = 'car-all-' ~ w.slug %}

      <div class="col">
        <div class="card h-100 shadow-sm">
          <div id="{{ cid }}" class="carousel slide" data-bs-ride="false">
            <div class="carousel-inner ratio ratio-16x9">
              {% for img in thumbs %}
                <div class="carousel-item {% if loop.first %}active{% endif %}">
                  <img
                    src="{{ img }}"
                    class="d-block w-100 h-100"
                    style="object-fit: cover;"
                    alt="{{ w.name }} image {{ loop.index }}"
                    loading="lazy">
                </div>
              {% endfor %}
            </div>

            {% if thumbs|length > 1 %}
              <button class="carousel-control-prev" type="button"
                      data-bs-target="#{{ cid }}" data-bs-slide="prev" aria-label="Previous image">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              </button>
              <button class="carousel-control-next" type="button"
                      data-bs-target="#{{ cid }}" data-bs-slide="next" aria-label="Next image">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
              </button>
            {% endif %}
          </div>

          <div class="card-body py-2 px-2">
            <h6 class="card-title mb-1">
              <a href="{{ url_for('workout_detail', slug=w.slug) }}"
                 class="stretched-link text-decoration-none">
                {{ w.name }}
              </a>
            </h6>
            <div class="small text-muted">
              {{ w.level }}{% if parts %} • {{ parts|join(', ') }}{% endif %}{% if w.style %} • {{ w.style }}{% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}

<div class="text-end mt-3">
  <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('workouts_browse') }}">Browse (filters &amp; search)</a>
</div>

{# Make carousel arrow clicks win over the stretched-link overlay #}
<style>
  .card { position: relative; }
  .card .stretched-link { z-index: 5; }
  .card .carousel-control-prev,
  .card .carousel-control-next { z-index: 10; }
</style>
{% endblock %}
